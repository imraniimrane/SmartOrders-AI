<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart Orders</title>
<style>
  :root {
    --cyan: #00bcd4;
    --dark-bg: #121212;
    --light-bg: #f5f5f5;
    --dark-text: #eee;
    --light-text: #222;
  }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--light-bg);
    color: var(--light-text);
    transition: background 0.3s, color 0.3s;
  }
  body.dark {
    background: var(--dark-bg);
    color: var(--dark-text);
  }
  /* Top bar */
  header {
    display: flex;
    align-items: center;
    background: var(--cyan);
    color: white;
    padding: 10px 20px;
  }
  #logo-section {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
    font-size: 1.3rem;
    user-select: none;
  }
  #profile-pic {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid white;
  }
  nav {
    display: flex;
    gap: 15px;
    margin-left: 40px;
    flex-grow: 1;
  }
  nav button.tab-btn {
    background: transparent;
    border: none;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: border-color 0.25s;
  }
  nav button.tab-btn.active {
    border-bottom: 3px solid white;
  }
  /* Auth Buttons on right */
  #auth-buttons {
    display: flex;
    gap: 15px;
  }
  #auth-buttons button {
    background: white;
    color: var(--cyan);
    border: none;
    padding: 7px 15px;
    font-weight: 600;
    border-radius: 20px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  #auth-buttons button:hover {
    background: #e0f7fa;
  }
  /* Container */
  main {
    padding: 20px;
  }
  /* Hide inactive tabs */
  .tab-content {
    display: none;
    max-width: 800px;
  }
  .tab-content.active {
    display: block;
  }

  /* Form inputs */
  input, select, textarea {
    width: 100%;
    padding: 8px 10px;
    margin: 8px 0 16px;
    border: 1.8px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.25s;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--cyan);
    outline: none;
  }

  /* Buttons */
  .btn {
    background: var(--cyan);
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 24px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .btn:hover {
    background: #0097a7;
  }
  /* Secondary btn */
  .btn-secondary {
    background: #e0e0e0;
    color: var(--cyan);
  }
  .btn-secondary:hover {
    background: #b2ebf2;
  }

  /* Table styles */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1.5px solid #ccc;
    padding: 10px;
    text-align: left;
  }
  th {
    background: var(--cyan);
    color: white;
  }
  body.dark th {
    background: #007c91;
  }

  /* Checkbox label */
  label.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
  }
  input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  /* Profile pic upload */
  #profile-pic-input {
    margin-top: 6px;
  }

  /* Email status */
  #email-status {
    font-weight: 600;
    margin-top: 8px;
  }

  /* Misc */
  .danger {
    background: #e53935;
  }
  .danger:hover {
    background: #b71c1c;
  }
</style>
</head>
<body>
<header>
  <div id="logo-section">
    <img id="profile-pic" src="https://i.pravatar.cc/36" alt="Profile Picture" />
    <div>Smart Orders</div>
  </div>
  <nav>
    <button class="tab-btn active" data-tab="database-tab">Database</button>
    <button class="tab-btn" data-tab="settings-tab">Settings</button>
    <button class="tab-btn" data-tab="account-tab">Account</button>
    <button class="tab-btn" data-tab="collab-tab">Collab</button>
  </nav>
  <div id="auth-buttons">
    <button id="btn-login">Log In</button>
    <button id="btn-signup">Sign Up</button>
  </div>
</header>

<main>
  <!-- LOGIN FORM -->
  <section id="login-form" class="tab-content">
    <h2>Log In</h2>
    <input type="email" id="login-email" placeholder="Email" required />
    <input type="password" id="login-password" placeholder="Password" required />
    <button class="btn" id="login-submit">Log In</button>
    <p id="login-msg" style="color:red;"></p>
  </section>

  <!-- SIGNUP FORM -->
  <section id="signup-form" class="tab-content">
    <h2>Sign Up</h2>
    <input type="email" id="signup-email" placeholder="Email" required />
    <input type="password" id="signup-password" placeholder="Password (min 6 chars)" required />
    <button class="btn" id="signup-submit">Sign Up</button>
    <p id="signup-msg" style="color:red;"></p>
  </section>

  <!-- DATABASE TAB -->
  <section id="database-tab" class="tab-content active">
    <h2>Database</h2>
    <form id="db-form">
      <input type="text" id="client-name" placeholder="Client Name" required />
      <input type="tel" id="phone-number" placeholder="Phone Number" required />
      <input type="text" id="product" placeholder="Product" required />
      <input type="number" id="quantity" placeholder="Quantity" min="1" required />
      <button type="submit" class="btn">Add to Database</button>
    </form>

    <h3>Current Database</h3>
    <table id="db-table">
      <thead>
        <tr><th>Client Name</th><th>Phone Number</th><th>Product</th><th>Quantity</th></tr>
      </thead>
      <tbody>
        <!-- Data rows here -->
      </tbody>
    </table>

    <div style="margin-top:15px;">
      <button class="btn-secondary" id="export-db">Export Database (.json)</button>
      <input type="file" id="import-db" accept=".json" style="margin-left:10px;" />
    </div>
  </section>

  <!-- SETTINGS TAB -->
  <section id="settings-tab" class="tab-content">
    <h2>Settings</h2>
    <label class="checkbox-label"><input type="checkbox" id="dark-mode-toggle" /> Dark Mode</label>
    <hr />
    <h3>About</h3>
    <p>Smart Orders is your modern order management app.</p>
    <hr />
    <h3>Email Us</h3>
    <form id="email-form">
      <input type="email" id="email-to" placeholder="Recipient Email" required />
      <input type="text" id="email-subject" placeholder="Subject" required />
      <textarea id="email-message" placeholder="Your message..." rows="5" required></textarea>
      <button type="submit" class="btn">Send Email</button>
      <div id="email-status"></div>
    </form>
    <hr />
    <h3>Extra Protection Email</h3>
    <input type="email" id="extra-email" placeholder="Add extra protection email" />
    <button id="extra-email-btn" class="btn-secondary">Send Verification Code</button>
    <p id="extra-email-msg" style="color:green;"></p>
    <hr />
    <h3>Profile Picture</h3>
    <input type="file" id="profile-pic-input" accept="image/*" />
  </section>

  <!-- ACCOUNT TAB -->
  <section id="account-tab" class="tab-content">
    <h2>Account</h2>
    <button class="btn" id="save-data-btn">Save Data to Cloud</button>
    <button class="btn" id="load-data-btn" style="margin-left:10px;">Load Data from Cloud</button>
    <button class="btn-danger danger" id="delete-account-btn" style="margin-left:10px;">Delete Account & Data</button>
    <button class="btn-secondary" id="logout-btn" style="margin-left:10px;">Log Out</button>
    <p id="account-msg" style="margin-top:15px; font-weight:bold;"></p>
  </section>

  <!-- COLLAB TAB -->
  <section id="collab-tab" class="tab-content">
    <h2>Collab (Placeholder)</h2>
    <p>This section is under development.</p>
  </section>
</main>

<script src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script>
  (function() {
    emailjs.init('27xvHIt7kuuZewPB3');
  })();
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Initial State
    let currentUser = null; // {email, profilePicDataUrl, database: [...]}
    let database = [];

    const tabs = document.querySelectorAll('button.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    const authButtons = document.getElementById('auth-buttons');
    const profilePicImg = document.getElementById('profile-pic');
    const logoSection = document.getElementById('logo-section');

    // Forms & UI elements
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const databaseTab = document.getElementById('database-tab');
    const settingsTab = document.getElementById('settings-tab');
    const accountTab = document.getElementById('account-tab');
    const collabTab = document.getElementById('collab-tab');

    const loginEmailInput = document.getElementById('login-email');
    const loginPasswordInput = document.getElementById('login-password');
    const loginMsg = document.getElementById('login-msg');

    const signupEmailInput = document.getElementById('signup-email');
    const signupPasswordInput = document.getElementById('signup-password');
    const signupMsg = document.getElementById('signup-msg');

    const dbForm = document.getElementById('db-form');
    const dbTableBody = document.querySelector('#db-table tbody');
    const exportDbBtn = document.getElementById('export-db');
    const importDbInput = document.getElementById('import-db');

    const darkModeToggle = document.getElementById('dark-mode-toggle');

    const emailForm = document.getElementById('email-form');
    const emailStatus = document.getElementById('email-status');

    const extraEmailInput = document.getElementById('extra-email');
    const extraEmailBtn = document.getElementById('extra-email-btn');
    const extraEmailMsg = document.getElementById('extra-email-msg');

    const profilePicInput = document.getElementById('profile-pic-input');

    const saveDataBtn = document.getElementById('save-data-btn');
    const loadDataBtn = document.getElementById('load-data-btn');
    const deleteAccountBtn = document.getElementById('delete-account-btn');
    const logoutBtn = document.getElementById('logout-btn');
    const accountMsg = document.getElementById('account-msg');

    // Auth Buttons
    const btnLogin = document.getElementById('btn-login');
    const btnSignup = document.getElementById('btn-signup');

    // Utils - fake cloud save using localStorage for demo
    function saveUserToCloud(user) {
      localStorage.setItem('smartOrdersUser_' + user.email, JSON.stringify(user));
    }
    function loadUserFromCloud(email) {
      const data = localStorage.getItem('smartOrdersUser_' + email);
      if (!data) return null;
      return JSON.parse(data);
    }
    function deleteUserFromCloud(email) {
      localStorage.removeItem('smartOrdersUser_' + email);
    }

    // Update UI on login/logout
    function updateUI() {
      if(currentUser) {
        authButtons.style.display = 'none';
        // Show Database, Settings, Account tabs
        tabs.forEach(t => t.style.display = 'inline-block');
        // Show database tab active, hide login/signup forms
        showTab('database-tab');
        // Show profile pic if exists
        if(currentUser.profilePicDataUrl) {
          profilePicImg.src = currentUser.profilePicDataUrl;
        } else {
          profilePicImg.src = 'https://i.pravatar.cc/36';
        }
        // Load database from user
        database = currentUser.database || [];
        renderDatabase();
        loginForm.classList.remove('active');
        signupForm.classList.remove('active');
      } else {
        // No user logged in
        authButtons.style.display = 'flex';
        tabs.forEach(t => t.style.display = 'none');
        hideAllTabs();
        // Show login form by default
        loginForm.classList.add('active');
        signupForm.classList.remove('active');
        profilePicImg.src = 'https://i.pravatar.cc/36';
        database = [];
        renderDatabase();
      }
    }

    function showTab(id) {
      tabContents.forEach(c => c.classList.remove('active'));
      document.getElementById(id).classList.add('active');

      tabs.forEach(t => {
        if(t.dataset.tab === id) {
          t.classList.add('active');
        } else {
          t.classList.remove('active');
        }
      });
    }

    function hideAllTabs() {
      tabContents.forEach(c => c.classList.remove('active'));
    }

    // Tab button clicks
    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        if(!currentUser) return; // no switching tabs without login
        showTab(tab.dataset.tab);
      });
    });

    // Auth buttons clicks
    btnLogin.addEventListener('click', () => {
      loginForm.classList.add('active');
      signupForm.classList.remove('active');
      hideAllTabs();
    });
    btnSignup.addEventListener('click', () => {
      signupForm.classList.add('active');
      loginForm.classList.remove('active');
      hideAllTabs();
    });

    // Signup submit
    document.getElementById('signup-submit').addEventListener('click', () => {
      const email = signupEmailInput.value.trim().toLowerCase();
      const pass = signupPasswordInput.value;
      signupMsg.textContent = '';

      if (!validateEmail(email)) {
        signupMsg.textContent = 'Invalid email.';
        return;
      }
      if(pass.length < 6){
        signupMsg.textContent = 'Password too short.';
        return;
      }
      // Check if user exists
      if(loadUserFromCloud(email)) {
        signupMsg.textContent = 'Email already registered.';
        return;
      }
      // Create new user
      currentUser = {
        email,
        password: pass,
        profilePicDataUrl: '',
        database: []
      };
      saveUserToCloud(currentUser);
      signupMsg.style.color = 'green';
      signupMsg.textContent = 'Account created! Logging in...';
      setTimeout(() => {
        signupMsg.textContent = '';
        updateUI();
      }, 1000);
    });

    // Login submit
    document.getElementById('login-submit').addEventListener('click', () => {
      const email = loginEmailInput.value.trim().toLowerCase();
      const pass = loginPasswordInput.value;
      loginMsg.textContent = '';

      const user = loadUserFromCloud(email);
      if(!user) {
        loginMsg.textContent = 'No such user.';
        return;
      }
      if(user.password !== pass) {
        loginMsg.textContent = 'Incorrect password.';
        return;
      }
      currentUser = user;
      updateUI();
    });

    // Log out
    logoutBtn.addEventListener('click', () => {
      currentUser = null;
      updateUI();
    });

    // Delete account and data
    deleteAccountBtn.addEventListener('click', () => {
      if(!currentUser) return;
      if(confirm('Delete your account and all data? This cannot be undone.')) {
        deleteUserFromCloud(currentUser.email);
        currentUser = null;
        updateUI();
