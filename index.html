<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SmartOrders - Login</title>
<style>
/* ... existing styles unchanged ... */
/* Add minimal extra style for database dropdown */
#db-select {
  margin: 15px 0;
  font-size: 1em;
  padding: 5px;
}
</style>
</head>
<body>
<header>
  SmartOrders
</header>
<div id="auth-page" class="container">
  <!-- ... unchanged auth forms ... -->
</div>
<div id="main-app" style="display:none;">
  <nav class="top-nav" role="navigation" aria-label="Main Navigation">
    <button id="nav-db" class="active" aria-pressed="true">View Databases</button>
    <button id="nav-settings" aria-pressed="false">Settings</button>
    <div class="right-buttons">
      <button id="btn-switch-account">Switch Account</button>
      <button id="btn-logout">Log Out</button>
    </div>
  </nav>
  <section id="database-page" class="container" tabindex="0" aria-label="Database Table">
    <label for="db-select"><strong>Choose Database:</strong></label>
    <select id="db-select"></select>
    <table>
      <thead>
        <tr>
          <th>Row Number</th>
          <th>Client Name</th>
          <th>Phone Number</th>
          <th>Product</th>
          <th>Quantity</th>
        </tr>
      </thead>
      <tbody id="data-table-body"></tbody>
    </table>
  </section>
  <section id="settings-page" class="container" style="display:none;" tabindex="0" aria-label="Settings">
    <h2>Settings</h2>
    <label for="darkmode-toggle">Dark Mode:</label>
    <label class="switch">
      <input type="checkbox" id="darkmode-toggle" aria-checked="false" />
      <span class="slider"></span>
    </label>
    <h3 style="margin-top: 30px;">Export / Import User Database</h3>
    <p>Copy this text to save users or paste to load users on another device:</p>
    <textarea id="export-area" aria-label="User database export/import"></textarea>
    <br />
    <button id="btn-export-users">Export Users</button>
    <button id="btn-import-users">Import Users</button>
    <h3 style="margin-top: 30px;">Your Databases</h3>
    <ul id="user-databases-list"></ul>
    <button id="btn-create-db">Create New Database</button>
    <div id="server-info">
      <p><strong>Note:</strong> This export/import simulates a server for syncing users between devices manually.</p>
    </div>
  </section>
</div>
<script>
const authPage = document.getElementById('auth-page');
const mainApp = document.getElementById('main-app');
const btnLoginTab = document.getElementById('btn-login');
const btnSignupTab = document.getElementById('btn-signup');
const loginForm = document.getElementById('login-form');
const signupForm = document.getElementById('signup-form');
const navDb = document.getElementById('nav-db');
const navSettings = document.getElementById('nav-settings');
const btnLogout = document.getElementById('btn-logout');
const btnSwitchAccount = document.getElementById('btn-switch-account');
const databasePage = document.getElementById('database-page');
const settingsPage = document.getElementById('settings-page');
const darkmodeToggle = document.getElementById('darkmode-toggle');
const exportArea = document.getElementById('export-area');
const btnExportUsers = document.getElementById('btn-export-users');
const btnImportUsers = document.getElementById('btn-import-users');
const btnCreateDb = document.getElementById('btn-create-db');
const dbSelect = document.getElementById('db-select');
const dataTableBody = document.getElementById('data-table-body');
const dbList = document.getElementById('user-databases-list');

let currentDatabase = 'default';

function setActivePage(page) {
  if(page === 'db') {
    navDb.classList.add('active');
    navDb.setAttribute('aria-pressed', 'true');
    navSettings.classList.remove('active');
    navSettings.setAttribute('aria-pressed', 'false');
    databasePage.style.display = 'block';
    settingsPage.style.display = 'none';
    databasePage.focus();
  } else {
    navSettings.classList.add('active');
    navSettings.setAttribute('aria-pressed', 'true');
    navDb.classList.remove('active');
    navDb.setAttribute('aria-pressed', 'false');
    databasePage.style.display = 'none';
    settingsPage.style.display = 'block';
    settingsPage.focus();
    updateDatabaseListUI();
  }
}
navDb.addEventListener('click', () => setActivePage('db'));
navSettings.addEventListener('click', () => setActivePage('settings'));

function getCurrentUser() {
  return sessionStorage.getItem('current-user');
}

function getUserDatabases() {
  const user = getCurrentUser();
  return JSON.parse(localStorage.getItem('dbs-' + user) || '{}');
}
function saveUserDatabases(dbs) {
  localStorage.setItem('dbs-' + getCurrentUser(), JSON.stringify(dbs));
}
function updateDatabaseListUI() {
  const dbs = getUserDatabases();
  dbList.innerHTML = '';
  Object.keys(dbs).forEach(name => {
    const li = document.createElement('li');
    li.textContent = name;
    dbList.appendChild(li);
  });
  updateDatabaseSelect();
}
function updateDatabaseSelect() {
  const dbs = getUserDatabases();
  dbSelect.innerHTML = '';
  Object.keys(dbs).forEach(name => {
    const opt = document.createElement('option');
    opt.value = name;
    opt.textContent = name;
    dbSelect.appendChild(opt);
  });
  dbSelect.value = currentDatabase;
}
function renderCurrentDatabase() {
  const dbs = getUserDatabases();
  const rows = dbs[currentDatabase] || [];
  dataTableBody.innerHTML = '';
  rows.forEach((r, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i+1}</td><td>${r.name}</td><td>${r.phone}</td><td>${r.product}</td><td>${r.qty}</td>`;
    dataTableBody.appendChild(tr);
  });
}
btnCreateDb.addEventListener('click', () => {
  const name = prompt('Enter new database name:');
  if(!name) return;
  const dbs = getUserDatabases();
  if(dbs[name]) return alert('Database already exists!');
  dbs[name] = [];
  saveUserDatabases(dbs);
  currentDatabase = name;
  updateDatabaseListUI();
  renderCurrentDatabase();
});
dbSelect.addEventListener('change', e => {
  currentDatabase = e.target.value;
  renderCurrentDatabase();
});
function startApp() {
  authPage.style.display = 'none';
  mainApp.style.display = 'block';
  const dbs = getUserDatabases();
  if(!dbs.default) {
    dbs.default = [
      { name: "Karim Zahir", phone: "00212601234567", product: "Olive Oil", qty: 10 },
      { name: "Salma Haddad", phone: "00212655111222", product: "Bottled Water", qty: 50 },
      { name: "Noura Mansour", phone: "0021267899900", product: "Olives", qty: 20 },
    ];
    saveUserDatabases(dbs);
  }
  currentDatabase = 'default';
  updateDatabaseListUI();
  renderCurrentDatabase();
  setActivePage('db');
}
window.addEventListener('load', () => {
  if(getCurrentUser()) startApp();
});
</script>
</body>
</html>
