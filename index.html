<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart Orders</title>
<style>
  :root {
    --cyan: #00bcd4;
    --dark-bg: #121212;
    --light-bg: #f5f5f5;
    --dark-text: #eee;
    --light-text: #222;
  }
  body {
    margin: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--light-bg);
    color: var(--light-text);
    transition: background 0.3s, color 0.3s;
  }
  body.dark {
    background: var(--dark-bg);
    color: var(--dark-text);
  }
  header {
    display: flex;
    align-items: center;
    background: var(--cyan);
    color: white;
    padding: 10px 20px;
  }
  #logo-section {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
    font-size: 1.3rem;
    user-select: none;
  }
  #profile-pic {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid white;
  }
  nav {
    display: flex;
    gap: 15px;
    margin-left: 40px;
    flex-grow: 1;
  }
  nav button.tab-btn {
    background: transparent;
    border: none;
    color: white;
    font-weight: 600;
    font-size: 1rem;
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: border-color 0.25s;
  }
  nav button.tab-btn.active {
    border-bottom: 3px solid white;
  }
  #auth-buttons {
    display: flex;
    gap: 15px;
  }
  #auth-buttons button {
    background: white;
    color: var(--cyan);
    border: none;
    padding: 7px 15px;
    font-weight: 600;
    border-radius: 20px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  #auth-buttons button:hover {
    background: #e0f7fa;
  }
  main {
    padding: 20px;
  }
  .tab-content {
    display: none;
    max-width: 800px;
  }
  .tab-content.active {
    display: block;
  }
  input, select, textarea {
    width: 100%;
    padding: 8px 10px;
    margin: 8px 0 16px;
    border: 1.8px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.25s;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--cyan);
    outline: none;
  }
  .btn {
    background: var(--cyan);
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 24px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  .btn:hover {
    background: #0097a7;
  }
  .btn-secondary {
    background: #e0e0e0;
    color: var(--cyan);
  }
  .btn-secondary:hover {
    background: #b2ebf2;
  }
  .btn-danger {
    background: #e53935;
    color: white;
  }
  .btn-danger:hover {
    background: #b71c1c;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1.5px solid #ccc;
    padding: 10px;
    text-align: left;
  }
  th {
    background: var(--cyan);
    color: white;
  }
  body.dark th {
    background: #007c91;
  }
  label.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
  }
  input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }
  #profile-pic-input {
    margin-top: 6px;
  }
  #email-status {
    font-weight: 600;
    margin-top: 8px;
  }
</style>
</head>
<body>
<header>
  <div id="logo-section">
    <img id="profile-pic" src="https://i.pravatar.cc/36" alt="Profile Picture" />
    <div>Smart Orders</div>
  </div>
  <nav>
    <button class="tab-btn active" data-tab="database-tab">Database</button>
    <button class="tab-btn" data-tab="settings-tab">Settings</button>
    <button class="tab-btn" data-tab="account-tab">Account</button>
    <button class="tab-btn" data-tab="collab-tab">Collab</button>
  </nav>
  <div id="auth-buttons">
    <button id="btn-login">Log In</button>
    <button id="btn-signup">Sign Up</button>
  </div>
</header>

<main>
  <!-- LOGIN FORM -->
  <section id="login-form" class="tab-content">
    <h2>Log In</h2>
    <input type="email" id="login-email" placeholder="Email" required />
    <input type="password" id="login-password" placeholder="Password" required />
    <button class="btn" id="login-submit">Log In</button>
    <p id="login-msg" style="color:red;"></p>
  </section>

  <!-- SIGNUP FORM -->
  <section id="signup-form" class="tab-content">
    <h2>Sign Up</h2>
    <input type="email" id="signup-email" placeholder="Email" required />
    <input type="password" id="signup-password" placeholder="Password (min 6 chars)" required />
    <button class="btn" id="signup-submit">Sign Up</button>
    <p id="signup-msg" style="color:red;"></p>
  </section>

  <!-- DATABASE TAB -->
  <section id="database-tab" class="tab-content active">
    <h2>Database</h2>
    <form id="db-form">
      <input type="text" id="client-name" placeholder="Client Name" required />
      <input type="tel" id="phone-number" placeholder="Phone Number" required />
      <input type="text" id="product" placeholder="Product" required />
      <input type="number" id="quantity" placeholder="Quantity" min="1" required />
      <button type="submit" class="btn">Add to Database</button>
    </form>

    <h3>Current Database</h3>
    <table id="db-table">
      <thead>
        <tr><th>Client Name</th><th>Phone Number</th><th>Product</th><th>Quantity</th></tr>
      </thead>
      <tbody>
        <!-- Data rows here -->
      </tbody>
    </table>

    <div style="margin-top:15px;">
      <button class="btn-secondary" id="export-db">Export Database (.json)</button>
      <input type="file" id="import-db" accept=".json" style="margin-left:10px;" />
    </div>
  </section>

  <!-- SETTINGS TAB -->
  <section id="settings-tab" class="tab-content">
    <h2>Settings</h2>
    <label class="checkbox-label"><input type="checkbox" id="dark-mode-toggle" /> Dark Mode</label>
    <hr />
    <h3>About</h3>
    <p>Smart Orders is your modern order management app.</p>
    <hr />
    <h3>Email Us</h3>
    <form id="email-form">
      <input type="email" id="email-to" placeholder="Recipient Email" required />
      <input type="text" id="email-subject" placeholder="Subject" required />
      <textarea id="email-message" placeholder="Your message..." rows="5" required></textarea>
      <button type="submit" class="btn">Send Email</button>
      <div id="email-status"></div>
    </form>
    <hr />
    <h3>Extra Protection Email</h3>
    <input type="email" id="extra-email" placeholder="Add extra protection email" />
    <button id="extra-email-btn" class="btn-secondary">Send Verification Code</button>
    <p id="extra-email-msg" style="color:green;"></p>
    <hr />
    <h3>Profile Picture</h3>
    <input type="file" id="profile-pic-input" accept="image/*" />
  </section>

  <!-- ACCOUNT TAB -->
  <section id="account-tab" class="tab-content">
    <h2>Account</h2>
    <p>Email: <span id="account-email">Not logged in</span></p>
    <button id="btn-logout" class="btn-danger">Log Out</button>
  </section>

  <!-- COLLAB TAB -->
  <section id="collab-tab" class="tab-content">
    <h2>Collaboration</h2>
    <p>This feature is under construction.</p>
  </section>
</main>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  emailjs.init('your_public_key_here'); // Replace with your EmailJS public key

  // Elements
  const tabs = document.querySelectorAll('nav button.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');
  const authButtons = document.getElementById('auth-buttons');
  const loginForm = document.getElementById('login-form');
  const signupForm = document.getElementById('signup-form');
  const loginMsg = document.getElementById('login-msg');
  const signupMsg = document.getElementById('signup-msg');
  const btnLogin = document.getElementById('btn-login');
  const btnSignup = document.getElementById('btn-signup');
  const btnLogout = document.getElementById('btn-logout');
  const accountEmail = document.getElementById('account-email');
  const profilePic = document.getElementById('profile-pic');
  const profilePicInput = document.getElementById('profile-pic-input');

  // Database form and table
  const dbForm = document.getElementById('db-form');
  const dbTableBody = document.querySelector('#db-table tbody');
  const exportBtn = document.getElementById('export-db');
  const importInput = document.getElementById('import-db');

  // Settings elements
  const darkModeToggle = document.getElementById('dark-mode-toggle');
  const emailForm = document.getElementById('email-form');
  const emailStatus = document.getElementById('email-status');
  const extraEmailBtn = document.getElementById('extra-email-btn');
  const extraEmailInput = document.getElementById('extra-email');
  const extraEmailMsg = document.getElementById('extra-email-msg');

  // State
  let currentUser = null;
  let database = [];

  // Helpers
  function saveToStorage() {
    localStorage.setItem('smartOrdersDatabase', JSON.stringify(database));
  }

  function loadFromStorage() {
    const saved = localStorage.getItem('smartOrdersDatabase');
    if (saved) {
      try {
        database = JSON.parse(saved);
      } catch {
        database = [];
      }
    } else {
      database = [];
    }
  }

  function renderDatabase() {
    dbTableBody.innerHTML = '';
    if (database.length === 0) {
      dbTableBody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#666;">No entries yet</td></tr>';
      return;
    }
    database.forEach(entry => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${entry.clientName}</td>
        <td>${entry.phoneNumber}</td>
        <td>${entry.product}</td>
        <td>${entry.quantity}</td>
      `;
      dbTableBody.appendChild(tr);
    });
  }

  // Auth (dummy demo, no backend)
  function login(email, password) {
    if (!validateEmail(email)) return 'Invalid email.';
    if (!password || password.length < 6) return 'Password must be at least 6 characters.';
    // Demo: Accept any email/password
    currentUser = { email };
    localStorage.setItem('smartOrdersUser', JSON.stringify(currentUser));
    return null;
  }

  function signup(email, password) {
    if (!validateEmail(email)) return 'Invalid email.';
    if (!password || password.length < 6) return 'Password must be at least 6 characters.';
    // Demo: Accept all signups
    currentUser = { email };
    localStorage.setItem('smartOrdersUser', JSON.stringify(currentUser));
    return null;
  }

  function logout() {
    currentUser = null;
    localStorage.removeItem('smartOrdersUser');
  }

  function updateUI() {
    if (currentUser) {
      authButtons.style.display = 'none';
      loginForm.style.display = 'none';
      signupForm.style.display = 'none';
      accountEmail.textContent = currentUser.email;
      btnLogout.style.display = 'inline-block';
      tabs.forEach(t => t.disabled = false);
    } else {
      authButtons.style.display = 'flex';
      loginForm.style.display = 'none';
      signupForm.style.display = 'none';
      accountEmail.textContent = 'Not logged in';
      btnLogout.style.display = 'none';
      tabs.forEach(t => t.disabled = true);
      // Force show login on logout
      showTab('login-form');
    }
  }

  // Tabs
  function showTab(tabName) {
    tabContents.forEach(c => {
      c.classList.toggle('active', c.id === tabName);
    });
    tabs.forEach(t => {
      if (t.dataset.tab === tabName) t.classList.add('active');
      else t.classList.remove('active');
    });
  }

  // Email validation
  function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
  }

  // Event Listeners

  // Tabs nav
  tabs.forEach(tabBtn => {
    tabBtn.addEventListener('click', () => {
      showTab(tabBtn.dataset.tab);
    });
  });

  // Login/signup buttons in header
  btnLogin.addEventListener('click', () => {
    showTab('login-form');
  });
  btnSignup.addEventListener('click', () => {
    showTab('signup-form');
  });

  // Login form submit
  document.getElementById('login-submit').addEventListener('click', () => {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value.trim();
    const err = login(email, password);
    if (err) {
      loginMsg.textContent = err;
    } else {
      loginMsg.textContent = '';
      updateUI();
      showTab('database-tab');
    }
  });

  // Signup form submit
  document.getElementById('signup-submit').addEventListener('click', () => {
    const email = document.getElementById('signup-email').value.trim();
    const password = document.getElementById('signup-password').value.trim();
    const err = signup(email, password);
    if (err) {
      signupMsg.textContent = err;
    } else {
      signupMsg.textContent = '';
      updateUI();
      showTab('database-tab');
    }
  });

  // Logout button
  btnLogout.addEventListener('click', () => {
    logout();
    updateUI();
  });

  // Database add form submit
  dbForm.addEventListener('submit', (e) => {
    e.preventDefault();
    if (!currentUser) {
      alert('Please log in to add entries.');
      return;
    }
    const clientName = document.getElementById('client-name').value.trim();
    const phoneNumber = document.getElementById('phone-number').value.trim();
    const product = document.getElementById('product').value.trim();
    const quantity = parseInt(document.getElementById('quantity').value, 10);

    if (!clientName || !phoneNumber || !product || !quantity || quantity < 1) {
      alert('Please fill out all fields correctly.');
      return;
    }
    database.push({ clientName, phoneNumber, product, quantity });
    saveToStorage();
    renderDatabase();
    dbForm.reset();
  });

  // Export database JSON
  exportBtn.addEventListener('click', () => {
    if (database.length === 0) {
      alert('Database is empty, nothing to export.');
      return;
    }
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(database, null, 2));
    const dlAnchor = document.createElement('a');
    dlAnchor.setAttribute("href", dataStr);
    dlAnchor.setAttribute("download", "smart_orders_database.json");
    document.body.appendChild(dlAnchor);
    dlAnchor.click();
    dlAnchor.remove();
  });

  // Import database JSON
  importInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
      try {
        const importedData = JSON.parse(event.target.result);
        if (!Array.isArray(importedData)) throw new Error('Invalid format');
        database = importedData;
        saveToStorage();
        renderDatabase();
        alert('Database imported successfully!');
      } catch (err) {
        alert('Failed to import database: Invalid JSON.');
      }
    };
    reader.readAsText(file);
    e.target.value = null; // reset input
  });

  // Dark mode toggle
  darkModeToggle.addEventListener('change', () => {
    if (darkModeToggle.checked) {
      document.body.classList.add('dark');
      localStorage.setItem('darkMode', 'enabled');
    } else {
      document.body.classList.remove('dark');
      localStorage.removeItem('darkMode');
    }
  });

  // Load dark mode preference
  if (localStorage.getItem('darkMode') === 'enabled') {
    darkModeToggle.checked = true;
    document.body.classList.add('dark');
  }

  // Email sending via EmailJS
  emailForm.addEventListener('submit', (e) => {
    e.preventDefault();
    emailStatus.style.color = 'black';
    emailStatus.textContent = 'Sending...';

    const toEmail = document.getElementById('email-to').value.trim();
    const subject = document.getElementById('email-subject').value.trim();
    const message = document.getElementById('email-message').value.trim();

    if (!validateEmail(toEmail) || !subject || !message) {
      emailStatus.style.color = 'red';
      emailStatus.textContent = 'Please fill all fields correctly.';
      return;
    }

    const templateParams = {
      to_email: toEmail,
      subject: subject,
      message: message
    };

    emailjs.send('your_service_id', 'your_template_id', templateParams)
      .then(() => {
        emailStatus.style.color = 'green';
        emailStatus.textContent = 'Email sent successfully!';
        emailForm.reset();
      })
      .catch(() => {
        emailStatus.style.color = 'red';
        emailStatus.textContent = 'Failed to send email.';
      });
  });

  // Extra email verification button (demo)
  extraEmailBtn.addEventListener('click', () => {
    const extraEmail = extraEmailInput.value.trim();
    if (!validateEmail(extraEmail)) {
      extraEmailMsg.style.color = 'red';
      extraEmailMsg.textContent = 'Invalid email address.';
      return;
    }
    extraEmailMsg.style.color = 'green';
    extraEmailMsg.textContent = `Verification code sent to ${extraEmail} (demo).`;
  });

  // Profile picture update
  profilePicInput.addEventListener('change', () => {
    const file = profilePicInput.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (e) => {
      profilePic.src = e.target.result;
      localStorage.setItem('profilePic', e.target.result);
    };
    reader.readAsDataURL(file);
  });

  // Load profile pic from localStorage
  const savedPic = localStorage.getItem('profilePic');
  if (savedPic) profilePic.src = savedPic;

  // Initialization
  window.addEventListener('DOMContentLoaded', () => {
    // Load user from storage
    const savedUser = localStorage.getItem('smartOrdersUser');
    if (savedUser) {
      currentUser = JSON.parse(savedUser);
    }
    // Load DB and render
    loadFromStorage();
    renderDatabase();
    updateUI();
  });
</script>
</body>
</html>
